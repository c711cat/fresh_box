"use strict";(self["webpackChunkfresh_box"]=self["webpackChunkfresh_box"]||[]).push([[387],{387:function(o,e,t){t.r(e),t.d(e,{default:function(){return Z}});var l=t(6768),s=t(4232);const n={key:1,class:"wrap"},a={class:"mx-auto mb-2 col-11 col-md-10 col-lg-11 col-xl-10 d-flex justify-content-between align-items-center flex-wrap"},d=(0,l.Lk)("h3",{class:"ps-2"},"後台優惠券列表",-1),i={class:"ps-2"},c={class:"row my-0 mx-auto align-items-center col-11 col-md-10 col-lg-11 col-xl-10"},p={key:0,class:"col-12 col-sm-4 col-lg-1 col-xl-1 text-success py-2"},u={key:1,class:"col-12 col-sm-4 col-lg-1 col-xl-1 text-secondary py-2"},r={class:"col-12 col-sm-4 col-lg-12 col-xl-2 py-2 text-end text-sm-start text-lg-end"},h=["onClick"],m=["onClick"];function b(o,e,t,b,C,k){const g=(0,l.g2)("LoadingView"),f=(0,l.g2)("CouponModal"),y=(0,l.g2)("DelModal");return(0,l.uX)(),(0,l.CE)(l.FK,null,[C.isLoading?((0,l.uX)(),(0,l.Wv)(g,{key:0})):((0,l.uX)(),(0,l.CE)("div",n,[(0,l.Lk)("header",a,[d,(0,l.Lk)("div",i,[(0,l.Lk)("button",{onClick:e[0]||(e[0]=o=>k.openCouponModal(!0)),type:"button",class:"btn btn-primary"}," 新增優惠券 ")])]),(0,l.Lk)("div",c,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(C.coupons,(e=>((0,l.uX)(),(0,l.CE)("section",{key:e.id,class:(0,s.C4)([{"bg-light":0===e.is_enabled},"row m-0 align-items-center border-top py-3"])},[(0,l.Lk)("div",{class:(0,s.C4)([{"text-secondary":0===e.is_enabled},"col-12 col-sm-4 col-lg-2 col-xl-2 py-2"])}," 名稱："+(0,s.v_)(e.title),3),(0,l.Lk)("div",{class:(0,s.C4)([{"text-secondary":0===e.is_enabled},"col-12 col-sm-4 col-lg-3 col-xl-2 py-2"])}," 折扣碼："+(0,s.v_)(e.code),3),(0,l.Lk)("div",{class:(0,s.C4)([{"text-secondary":0===e.is_enabled},"col-12 col-sm-4 col-lg-3 col-xl-2 py-2"])}," 總金額乘以 "+(0,s.v_)(e.percent)+" ％ ",3),(0,l.Lk)("div",{class:(0,s.C4)([{"text-secondary":0===e.is_enabled},"col-12 col-sm-4 col-lg-3 col-xl-3 py-2"])}," 使用期限："+(0,s.v_)(o.$filters.changeDateStyle(e.due_date)),3),e.is_enabled?((0,l.uX)(),(0,l.CE)("div",p," 啟用 ")):((0,l.uX)(),(0,l.CE)("div",u," 未啟用 ")),(0,l.Lk)("div",r,[(0,l.Lk)("button",{onClick:o=>k.openCouponModal(C.isNew,e),type:"button",class:"btn btn-outline-dark-primary rounded-1 me-2 my-1"}," 編輯 ",8,h),(0,l.Lk)("button",{onClick:o=>k.openDelModal(e),type:"button",class:"btn btn-outline-danger rounded-1 my-1"}," 刪除 ",8,m)])],2)))),128))])])),(0,l.bF)(f,{onEditCoupon:k.updateCoupon,onAddCoupon:k.addCoupon,coupon:C.tempCoupon,ref:"couponModal"},null,8,["onEditCoupon","onAddCoupon","coupon"]),(0,l.bF)(y,{ref:"delModal",onDelCoupon:k.delCoupon,coupon:C.tempCoupon},null,8,["onDelCoupon","coupon"])],64)}var C=t(5130);const k=o=>((0,l.Qi)("data-v-1f033081"),o=o(),(0,l.jt)(),o),g={ref:"Modal",class:"modal fade",id:"admin'sCouponModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},f={class:"modal-dialog modal-xl"},y={class:"modal-content"},L={class:"modal-header ps-4"},x={key:0,class:"modal-title"},v={key:1,class:"modal-title"},_=k((()=>(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))),M={class:"modal-body ms-3"},$={class:"row g-3"},w={class:"col-12 col-lg-6 col-xl-3"},D=k((()=>(0,l.Lk)("div",{class:"d-inline text-danger"},"＊",-1))),E=k((()=>(0,l.Lk)("label",{for:"name",class:"form-label"},"優惠券名稱",-1))),X={class:"col-12 col-lg-6 col-xl-3"},S=k((()=>(0,l.Lk)("div",{class:"d-inline text-danger"},"＊",-1))),A=k((()=>(0,l.Lk)("label",{for:"couponCode",class:"form-label"},"折扣碼",-1))),V={class:"col-12 col-lg-6 col-xl-3"},F=k((()=>(0,l.Lk)("div",{class:"d-inline text-danger"},"＊",-1))),I=k((()=>(0,l.Lk)("label",{for:"percent",class:"form-label"},"總金額打幾折（單位：％）",-1))),U={class:"col-12 col-lg-6 col-xl-3"},J=k((()=>(0,l.Lk)("div",{class:"d-inline text-danger"},"＊",-1))),j=k((()=>(0,l.Lk)("label",{for:"dueDate",class:"form-label"},"有效期限",-1))),O=["min"],T={class:"col-lg-12 col-xl-12 form-check checkStyle"},K=k((()=>(0,l.Lk)("label",{class:"form-check-label",for:"is_enabled"}," 啟用 ",-1))),N={class:"modal-footer"},B=k((()=>(0,l.Lk)("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1)));function H(o,e,t,s,n,a){return(0,l.uX)(),(0,l.CE)("div",g,[(0,l.Lk)("div",f,[(0,l.Lk)("div",y,[(0,l.Lk)("header",L,[n.tempCoupon.id?((0,l.uX)(),(0,l.CE)("h5",x,"編輯優惠券")):((0,l.uX)(),(0,l.CE)("h5",v,"新增優惠券")),_]),(0,l.Lk)("div",M,[(0,l.Lk)("form",$,[(0,l.Lk)("div",w,[D,E,(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.tempCoupon.title=o),type:"text",class:"form-control",id:"name",placeholder:"例如：首購滿千9折優惠"},null,512),[[C.Jo,n.tempCoupon.title]])]),(0,l.Lk)("div",X,[S,A,(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.tempCoupon.code=o),type:"text",class:"form-control",id:"couponCode",placeholder:"例如：FIRST"},null,512),[[C.Jo,n.tempCoupon.code]])]),(0,l.Lk)("div",V,[F,I,(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.tempCoupon.percent=o),type:"number",min:"0",max:"100",class:"form-control",id:"percent",placeholder:"例如：打9折請輸入90"},null,512),[[C.Jo,n.tempCoupon.percent,void 0,{number:!0}]])]),(0,l.Lk)("div",U,[J,j,(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.due_date=o),type:"date",class:"form-control",id:"dueDate",min:a.minDate},null,8,O),[[C.Jo,n.due_date]])]),(0,l.Lk)("div",T,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.tempCoupon.is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled"},null,512),[[C.lH,n.tempCoupon.is_enabled]]),K])])]),(0,l.Lk)("footer",N,[B,n.tempCoupon.id?((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:e[5]||(e[5]=e=>o.$emit("edit-coupon",n.tempCoupon)),type:"button",class:"btn btn-primary"}," 更新優惠券 ")):((0,l.uX)(),(0,l.CE)("button",{key:1,onClick:e[6]||(e[6]=e=>o.$emit("add-coupon",n.tempCoupon)),type:"button",class:"btn btn-primary"}," 新增優惠券 "))])])])],512)}var Q=t(3286),R={data(){return{modal:{},tempCoupon:{},due_date:""}},props:{coupon:{type:Object,default(){return{}}}},watch:{coupon(){if(this.tempCoupon=this.coupon,this.tempCoupon.id){{const o=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");this.due_date=o[0]}this.coupon.is_enabled?this.tempCoupon.is_enabled=this.coupon.is_enabled:this.tempCoupon.is_enabled=0}},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date))/1e3}},mixins:[Q.A],computed:{minDate(){let o="";const e=(new Date).toISOString().split("T");return o=e[0],o}}},W=t(1241);const q=(0,W.A)(R,[["render",H],["__scopeId","data-v-1f033081"]]);var z=q,G=t(3985),P={data(){return{coupons:[],tempCoupon:{},isNew:!1,isLoading:!1}},components:{CouponModal:z,DelModal:G.A},methods:{getCoupons(){const o=1,e=`https://vue3-course-api.hexschool.io/v2/api/fresh_box-api/admin/coupons?page=${o}`;this.isLoading=!0,this.$http.get(e).then((o=>{this.coupons=o.data.coupons,this.isLoading=!1}))},addCoupon(o){const e="https://vue3-course-api.hexschool.io/v2/api/fresh_box-api/admin/coupon";this.isLoading=!0,this.$http.post(e,{data:o}).then((()=>{this.$refs.couponModal.hideModal(),this.$pushMsg.status200("新增優惠券成功"),this.getCoupons()})).catch((o=>{this.$pushMsg.status404(o.response,"新增優惠券失敗")})).finally((()=>{this.isLoading=!1}))},openCouponModal(o,e){this.$refs.couponModal.showModal(),this.tempCoupon=o?{is_enabled:0}:{...e}},updateCoupon(o){const e=`https://vue3-course-api.hexschool.io/v2/api/fresh_box-api/admin/coupon/${o.id}`;this.isLoading=!0,this.$http.put(e,{data:o}).then((()=>{this.$refs.couponModal.hideModal(),this.$pushMsg.status200("已更新優惠券"),this.getCoupons()})).catch((o=>{this.$pushMsg.status404(o.response,"更新優惠券失敗")})).finally((()=>{this.isLoading=!1}))},openDelModal(o){this.$refs.delModal.showModal(),this.tempCoupon={...o}},delCoupon(o){const e=`https://vue3-course-api.hexschool.io/v2/api/fresh_box-api/admin/coupon/${o.id}`;this.isLoading=!0,this.$http.delete(e).then((()=>{this.$refs.delModal.hideModal(),this.$pushMsg.status200("已刪除優惠券"),this.getCoupons()})).catch((o=>{this.$pushMsg.status404(o.response,"刪除失敗")})).finally((()=>{this.isLoading=!1}))}},created(){this.getCoupons()}};const Y=(0,W.A)(P,[["render",b]]);var Z=Y}}]);
//# sourceMappingURL=387.1e70dfb6.js.map